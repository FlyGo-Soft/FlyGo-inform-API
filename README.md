# API для интеграции с приложением FlyGo inform

## Выполнение запросов к API

Для корректной работы приложения на Вашей стороне должны быть реализованы и предоставлены следующие POST методы:

### 1) https://example.com/api/user

  Метод используется для обновления необходимой информации о конкретном пользователе системы.
  Возможные случаи изменения запроса:
  получение ознакомительной информации о пользователе

  Данный метод на вход принимает следующие параметры:

+ Параметр `account` содержит `login` `password` в зашифрованном виде (Подробнее в разделе Защита, пункт 1)
+ + Параметр `login` содержит логин конкретного пользователя системы
+ + Параметр `password` содержит пароль конкретного пользователя системы в зашифрованном виде (Подробнее в разделеЗащита, пункт 1)
+ Параметр `contractId` `(необязательный)` содержит идентификатор контракта данного пользователя.
+ Параметр `personalAccountId` `(необязательный)` содержит идентификатор лицевого счета пользователя.

  Пример ответа в формате json:

  ```json
  {
        "contract_id": "12763",
        "contract_name": "Номер договора",
        "personalAccountId": "12763",
        "name": "Иван Иванович Иванов",
        "universal": "Ваш доп текст",
        "money": 145,
        "tariff": {
          "id": 1,
          "title": "Тотальный безлимит",
          "desc": "Всё, что нужно, чтобы сделать свой дом приятным для отдыха. Наслаждайтесь интернетом на хорошей скорости и   цифровым телевидением с прекрасным выбором телеканалов.",
          "time_end": 1444729257026,
          "price": 350,
          "features": [
            {
              "title": "Интернет",
              "list": [
                "Входящая/исходящая скорости в Интернет до 15 Мбит/с",
                "Скорость внутри сети до 100 Мбит/c"
              ]
            },
            {
              "title": "ТВ HD",
              "list": [
                "100 цифровых телеканалов",
                "250 Телеканалов HD"
              ]
            }
          ],
          "payment_period": "month",
          "grace_price": 200,
          "grace_end": 1444732427318
        },
        "next_tariff": {
          "id": 2,
          "title": "Ночной город",
          "price": 100,
          "payment_period": "month"
        },
        "availableTariffs": [
            {
                "id": 2,
                "title": "Тотальный безлимит",
                "desc": "Всё, что нужно, чтобы сделать свой дом приятным для отдыха. Наслаждайтесь интернетом на хорошей скорости и   цифровым телевидением с прекрасным выбором телеканалов.",
                "price": 350,
                "charge": 50,
                "payment_period": "month",
                "features": [
                    {
                      "title": "Интернет",
                      "list": [
                        "Входящая/исходящая скорости в Интернет до 15 Мбит/с",
                        "Скорость внутри сети до 100 Мбит/c"
                      ]
                    },
                    {
                      "title": "ТВ HD",
                      "list": [
                        "100 цифровых телеканалов",
                        "250 Телеканалов HD"
                      ]
                    }
                ]
            }
        ],
        "payment_history": [
          {
            "title": "Оплата интернета",
            "date_pay": 1444729257026,
            "summ": 300,
            "pay_type": "+"
         }
        ],
        "remainders": [
            {
                "type": "custom",
                "title": "Остаток пакета Интернет",
                "total":"15",
                "available":"12",
                "unit":"Гб"
            }
        ],
        "contracts": [
            {
                "id": "12763",
                "name": "40/001",
                "personalAccounts": [
                    {
                        "id": "12763"
                    }
                ]
            },
            {
                "id": "108624",
                "name": "40/001закрытый",
                "personalAccounts": [
                    {
                        "id": "108624"
                    }
                ]
            }
        ],
        "activeTariffs": [
            {
                "contractId": "108624",
                "personalAccountId": "108624",
                "id": "1331",
                "title": "Хостинг Начальный-2",
                "desc": "Хостинг",
                "grace_price": null,
                "grace_period": null,
                "features": [],
                "price": null,
                "time_end": 1490990400000,
                "payment_period": null,
                "next_tariff": {
                    "id": 2,
                    "title": "Ночной город",
                    "price": 100,
                    "payment_period": "month"
                }
            }
        ],
    }
  ```

  При успешной аутентификации передается ответ в приведенном виде со следующими параметрами:

  + Параметр `contract_id` содержит номер договора.
  + Параметр `contract_name` содержит название контракта либо договора.
  + Параметр `name` содержит период Ф.И.О. пользователя.
  + Параметр `universal` содержит строковое значение. Тут может быть любой ваш текст для отображения в лк.
  + Параметр `money` содержит баланс пользователя. Содержит только цифры.
  + Параметр `tariff` содержит объект с информацией о тарифе.
  + + Параметр `id` содержит идентификатор тарифа пользователя.
  + + Параметр `title` содержит название тарифа.
  + + Параметр `desc` содержит описание тарифа.
  + + Параметр `time_end` содержит дату окончания тарифа. Формат даты timestamp.
  + + Параметр `price` содержит цену тарифа. Содержит только цифры.
  + + Параметр `charge` содержит стоимость перехода на тариф. Содержит только цифры.
  + + Параметр `features` содержит массив особенностей тарифа с приведенными ключами.
  + + + Параметр `title` содержит название особенности тарифа.
  + + + Параметр `list` содержит описание особенности тарифа.
  + + Параметр `payment_period` содержит период оплаты услуги. Возможны следующие данные: year|month|day.
  + + Параметр `grace_price` содержит акционную цену тарифа. Содержит цифры. (Если будет null, то скидка не будет учитываться)
  + + Параметр `grace_end` содержит время завершения акции. Формат даты timestamp. (Если будет null, то скидка не будет учитываться)
  + Параметр `next_tariff` содержит объект с информацией о следующем тарифе.
  + + Параметр `id` содержит идентификатор тарифа пользователя.
  + + Параметр `title` содержит название тарифа.
  + + Параметр `price` содержит цену тарифа.
  + + Параметр `payment_period` содержит период оплаты услуги. Возможны следующие данные: year|month|day.
  + Параметр `availableTariffs` является массивом, доступные для подключения тарифы, параметры аналогичны объекту `tariff`
  + Параметр `payment_history` является массивом, содержащим следующие параметры:
  + + Параметр `title` содержит название платежа.
  + + Параметр `date_pay` содержит дату проведения платежа. Формат даты timestamp.
  + + Параметр `summ` содержит сумму платежа. Содержит только цифры.
  + + Параметр `pay_type` содержит тип платежа. Пополнение (+) или списание (-). Содержит только приведенные значения.
  + Параметр `remainders` является массивом, содержит список прогресс-баров представленных на главной странице услуги, содержит следующие параметры:
  + + Параметр `type` содержит тип прогресс-бара, доступные типы: "custom".
  + + Параметр `title` содержит название прогресс-бара.
  + + Параметр `total` содержит максимальное значение прогресс-бара.
  + + Параметр `available` содержит текущее значение прогресс-бара.
  + + Параметр `unit` содержит название единицы измерения прогресс-бара.
  + Параметр `contracts` массив, содержит данные о договорах пользователя
  + + Параметр `id` содержит идентификатор договора
  + + Параметр `name` содержит название договора.
  + + Параметр `personalAccount` массив, содержит объекты с данными о номере счета клиента
  + + + Параметр `id` содержит номер счета клиента
  + Параметр `activeTariffs`массив, содержит объекты с тарифами, содержащие такие же данные, что и в `tariff`, но содержит дополнительные параметры
  + + `contractId` содержащий идентификатор договора на который подключен тариф
  + + Параметр `next_tariff` содержит объект с информацией о следующем тарифе.
  + + + Параметр `id` содержит идентификатор тарифа пользователя. Содержит только цифры.
  + + + Параметр `title` содержит название тарифа.
  + + + Параметр `price` содержит цену тарифа. Содержит только цифры.
  + + + Параметр `payment_period` содержит период оплаты услуги. Возможны следующие данные: year|month|day.
  + + `personalAccountId` содержащий идентификатор лицевого счета на который подключен тариф

  В случае ошибки аутентификации возвращается ответ со статусом 400

### 2) https://example.com/api/tariffChanged

  Метод используется для уведомления о смене тарифа. Данные будут переданы во входных параметрах.

  Данный метод на вход принимает следующие параметры:

+ Параметр `login` содержит логин конкретного пользователя системы
+ Параметр `tariff_id` содержит id нового тарифа
+ Параметр `query` содержит информацию о том, как нужно изменить тариф. 0 - изменить тариф сейчас, 1 - изменить по завершению текущего тарифа

  Пример ответа в формате json:

  ```json
  {
        "status": true
  }
  ```

  В случае, если тариф изменить нельзя, выходной параметр `status` должен иметь значение `false`

### 3) https://example.com/api/supportAppeal

  Метод используется для уведомления об обращении пользователя в техподдержку. Данные будут переданы во входных параметрах.

  Данный метод на вход принимает следующие параметры:

+ Параметр `login` содержит логин пользователя системы, обратившегося в поддержку
+ Параметр `msg` содержит сообщение пользователя
+ Параметр `name` содержит имя пользователя
+ Параметр `phone` содержит телефон пользователя
+ Параметр `email` содержит email пользователя

  Пример ответа в формате json:
  ```json
  {
        "status": true
  }
  ```

### 4) https://example.com/api/newBid

  Метод используется для уведомления о новой заявке на подключение. Данные будут переданы во входных параметрах.

  Данный метод на вход принимает следующие параметры:

+ Параметр `tel` содержит телефон подключаемого пользователя
+ Параметр `city` содержит город пользователя
+ Параметр `street` содержит улицу пользователя
+ Параметр `house` содержит дом пользователя
+ Параметр `time` содержит время составления заявки
+ Параметр `serviceid` содержит название подключаемой услуги
+ Параметр `tariff` содержит подключаемый тариф

  Пример ответа в формате json:

```json
{
    "status": true
}
```

  Предполагается, что полученные данные будут использованы для регистрации заявки в Вашей системе

### 5) https://example.com/api/getServices

 Метод используется для получение списка услуг, в том числе уже подключенных.

 Данный метод на вход принимает следующие параметры:

+ Параметр `account` содержит `login` `password` в зашифрованном виде (Подробнее в разделе Защита, пункт 1)

  Пример ответа в формате json:

```json
{
    "status": true,
    "info": {
        "id": 1,
        "title": "Пакет каналов HD",
        "desc": "Пакет каналов для каждого дома, выгодное предложение",
        "price": 300,
        "payment_period": "day",
        "connection_price": "200",
        "active": 1,
        "chain": "1,2"
    }
}
```

+ Параметр `info` содержит уникальный массив с приведенными ключами, содержащий список всех услуг.
+ + Параметр `id` содержит уникальный идентификатор услуги. Содержит только цифры.
+ + Параметр `title` содержит название услуги.
+ + Параметр `desc` содержит описание услуги.
+ + Параметр `price` содержит абонентскую плату. Содержит только цифры.
+ + Параметр `payment_period` содержит период оплаты услуги. Возможны следующие данные: year|month|day.
+ + Параметр `connection_price` содержит цену подключения. Содержит только цифры.
+ + Параметр `active` содержит статус подключения услуги. Возможны следующие: 1(true), 0(false).
+ + Параметр `chain` содержит строку - список связей с другими улугами. Содержит цифры и знак запятой (без пробела), как разделитель в случае связи с несколькими услугами.

  В случае успеха вернется статус ответа 200 иначе 400 со ```{ "status": false }```.

### 6) https://example.com/api/services

  Метод используется для уведомления об подключении или отключении услуги. Данные будут переданы во входных параметрах.

  Данный метод на вход принимает следующие параметры:

+ Параметр `login` содержит логин пользователя
+ Параметр `password` содержит пароль пользователя
+ Параметр `id` содержит id подключенной услуги
+ Параметр `status` содержит булевое значение, подключение/отключение услуги

  Пример ответа в формате json:
  ```json
  {
        "status": true
  }
  ```

  В случае, если услугу нельзя подключить/отключить, выходной параметр `status` должен иметь значение `false`

### 7) https://example.com/api/lkrequest

  Метод используется для уведомления о запросе пользователя на создание личного кабинета. Данные будут переданы во входных параметрах.

  Данный метод на вход принимает следующие параметры:

+ Параметр `tel` содержит телефон пользователя

  Пример ответа в формате json:

  ```json
  {
        "status": true
  }
  ```

### 8) https://example.com/api/getContractsList

Метод используется для получения данных о договорах и счетах пользователя.

+ Параметр `account` содержит `login` `password` в зашифрованном виде (Подробнее в разделе Защита, пункт 1)
+ + Параметр `login` содержит логин конкретного пользователя системы
+ + Параметр `password` содержит пароль конкретного пользователя системы в зашифрованном виде (Подробнее в разделе Защита, пункт 1)

  Пример ответа в формате json:

    ```json
    {
        "status": true,
        "type": "Номер договора",
        "contracts": [
            {
                "id": "12763",
                "name": "Договор 1",
                "personalAccounts": [
                    {
                        "id": "12763"
                    }
                ]
            },
            {
                "id": "108624",
                "name": "Договор 2",
                "personalAccounts": [
                    {
                        "id": "108624"
                    }
                ]
            }
        ]
    }
    ```

+ Параметр `type` строка, содержит название договора
+ Параметр `contracts` массив, содержит данные о договорах пользователя
+ + Параметр `id` содержит идентификатор договора
+ + Параметр `name` содержит название договора.
+ + Параметр `personalAccounts` массив, содержит объекты с данными о номере счета клиента
+ + + Параметр `id` содержит номер счета клиента

## Защита

### 1) Передача логина и пароля в запросах

  1 этап:

  Пароль пользователя шифруется с помощью алгоритма AES_256_CTR с ключом (md5 от уникальной вашей соли), или используется хеширование md5 от пароля (в этом случае шифрование не обратимое). Мы даем вам выбор по типу шифрования (обратимое или нет). В примере указан AES. Логин остается открытым

  Пример выходных данных 1 этапа (PHP):

  ```php
  array('username' => 'demo_login', 'password' => 'H069Vzs7OzuJ1b7zggDjFnI/g2RG')
  ```

  В данном примере соль была md5('demo_salt')
  Чистый пароль был 'demo_password'
  После шифрования получили пароль такого вида - 'H069Vzs7OzuJ1b7zggDjFnI/g2RG'

  2 этап (Опционален):

  Далее логин и пароль шифруются с помощью Rijndael 256 с вашим уникальным ключем

  Пример выходных данных 2 этапа (JSON):

  ```json
  {
    "account":"i6Gc/L1NACdey+/Erna3oqRSV3+TIIoRQro+4AG7cEqY1I/4fabHHQgDanApqKT2X8qLHljbMQUZDIQUzQJWJHMAlo5t7vHW0J6sIH9xadCx0eyEk7UvA2FMXjMn2fOudZYWmhLpc7ydBjIE5Suf832l91ZaGvysAtz2TLIBmm7ydLrQLj+DdXailw/3qtWoQEnXWYnaTZMAr5kjBch+/A==|L5ke2oSfANK6fQvpxiCOi4A1C07BPKitaPrF6aK9M+w="
  }
  ```

  В данным примере ключ был '64656d6f5f73616c745f737461676532'

  Результат 2 этапа используется для передачи данных.

  Уникальные ключи сообщаются в начале процесса интеграции.